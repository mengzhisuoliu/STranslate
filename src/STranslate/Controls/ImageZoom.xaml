<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cnvt="clr-namespace:STranslate.Converters"
    xmlns:control="clr-namespace:STranslate.Controls"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
    xmlns:vm="clr-namespace:STranslate.ViewModels">

    <Style TargetType="{x:Type control:ImageZoom}">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Focusable" Value="True" />
        <Setter Property="ui:ControlHelper.CornerRadius" Value="{DynamicResource {x:Static ui:ThemeKeys.ControlCornerRadiusKey}}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type control:ImageZoom}">
                    <Border
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        ClipToBounds="True">
                        <Grid x:Name="PART_ImageContainer" Background="Transparent">

                            <!--  Viewbox会处理Uniform拉伸和居中  -->
                            <Viewbox x:Name="PART_Viewbox" Stretch="Uniform">
                                <Viewbox.RenderTransformOrigin>0.5,0.5</Viewbox.RenderTransformOrigin>
                                <Viewbox.RenderTransform>
                                    <TransformGroup>
                                        <ScaleTransform x:Name="PART_ScaleTransform" />
                                        <TranslateTransform x:Name="PART_TranslateTransform" />
                                    </TransformGroup>
                                </Viewbox.RenderTransform>
                                <!--  在Viewbox内部，Grid的尺寸将与图片源的尺寸保持一致  -->
                                <Grid Width="{Binding Path=Source.PixelWidth, ElementName=PART_Image}" Height="{Binding Path=Source.PixelHeight, ElementName=PART_Image}">
                                    <Image
                                        x:Name="PART_Image"
                                        RenderOptions.BitmapScalingMode="HighQuality"
                                        SnapsToDevicePixels="True"
                                        Source="{TemplateBinding Source}"
                                        Stretch="Fill" />

                                    <!--  // OCR交互画布 //  -->
                                    <Canvas
                                        x:Name="PART_InteractionCanvas"
                                        Background="Transparent"
                                        Visibility="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=OcrWords.Count, Converter={cnvt:CountToVisibilityConverter}}" />
                                </Grid>
                            </Viewbox>

                            <Border
                                x:Name="PART_ScaleTextBorder"
                                Width="Auto"
                                Height="30"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Background="#a0000000"
                                BorderThickness="0"
                                CornerRadius="10">
                                <Border.Style>
                                    <Style TargetType="{x:Type Border}">
                                        <Setter Property="Opacity" Value="0" />
                                    </Style>
                                </Border.Style>
                                <TextBlock
                                    Margin="15,0"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="15"
                                    Foreground="White"
                                    Text="{Binding ElementName=PART_ScaleTransform, Path=ScaleX, Mode=OneWay, Converter={cnvt:PercentageFormatConverter}}" />
                            </Border>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>